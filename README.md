# Trade Time Analysis Tester

A command-line tool that analyses a trade history CSV and produces a multi-panel dashboard showing performance metrics — expected value, win rate, and trade count — broken down by hour of day, day of week, and trading session.

---

## Requirements

Install all dependencies with:

```
pip install -r requirements.txt
```

The `pytz` package is required and must be present in `requirements.txt`.

---

## Input File Format

The tool expects a CSV with the following two columns:

```
exit_datetime,result
2024-01-15 09:32:00,TP
2024-01-15 10:14:00,SL
2024-01-15 11:45:00,OPEN
```

- `exit_datetime` — timestamp of when the trade closed (TP hit, SL hit, or end of data)
- `result` — one of `TP`, `SL`, or `OPEN`

The timestamps must be in **UTC** if generated by the strategy backtest pipeline (`trades_to_csv_datetime`). See the note on timezones below.

---

## Usage

```
python3 trade_tester.py --file trades_datetime.csv
```

After launching, you will be prompted for the timezone the trades were recorded in:

```
  Common examples: UTC, US/Eastern, Europe/London, Asia/Tokyo,
                   America/New_York, Europe/Berlin, Asia/Singapore

Timezone of trades: UTC
```

Since the backtest pipeline records all timestamps in UTC, enter `UTC` when using data produced by `trades_to_csv_datetime`.

---

## Metrics

All three core metrics are computed per hour, per day, and per session:

| Metric | Definition |
|---|---|
| Trades | Total number of trade exits in that period |
| Win rate | Percentage of trades that hit TP (OPEN trades are excluded from the win rate numerator but included in the total) |
| EV (Expected Value) | Mean outcome where TP = +1, SL = -1, OPEN = 0. Positive EV indicates a profitable period. |

---

## Trading Sessions

Sessions are defined in UTC and used to group trades regardless of the local timezone entered:

| Session | UTC Hours |
|---|---|
| Sydney | 21:00 – 06:00 |
| Tokyo | 00:00 – 09:00 |
| London | 07:00 – 16:00 |
| New York | 12:00 – 21:00 |
| Overlap | Two or more sessions active simultaneously |
| Off-hours | No major session active |

---

## Output

**Console** — printed immediately after loading:

```
Total trades  : 312
Win rate      : 58.3%  (182 TP / 130 SL)
EV (raw)      : +0.1667

Best periods by EV:
  Best hour    : 10  (EV +0.412)
  Best day     : Tuesday  (EV +0.289)
  Best session : London  (EV +0.231)
```

**Plot dashboard** — a window displaying nine panels arranged across four rows, saved as `trade_time_analysis.png`:

| Row | Panel | Description |
|---|---|---|
| 1 | Hourly triple-bar | Bar chart of trade count per local hour with win rate % and EV x100 overlaid as lines |
| 1 | Hourly stacked bar | TP / SL / OPEN counts stacked per local hour |
| 2 | Daily triple-bar | Same three metrics broken down by day of week |
| 2 | Daily stacked bar | TP / SL / OPEN counts stacked per day of week |
| 3 | EV heatmap | Full day-of-week x local hour grid coloured red-to-green by mean EV, with the raw EV value annotated in each cell that has at least one trade |
| 4 | Session pie | Trade distribution across all sessions as a percentage pie chart |
| 4 | Session win rate / EV | Horizontal bar chart comparing win rate and EV x100 across sessions |
| 4 | Summary | Overview of totals, win rate, EV, and the single best-performing hour, day, and session |

The dashboard is saved as `trade_time_analysis.png` in the current directory.

---

## File Structure

```
.
├── main.py          # Trade time analysis entry point
├── requirements.txt         # Python dependencies
├── trades_datetime.csv      # Input: trade exit timestamps and results
└── trade_time_analysis.png  # Output: generated dashboard (after running)
```